# ğŸš€ Phase-27 â€œCLI polish & CI hardeningâ€ â€“ task list for copilot_agent
#
# Context:
#   â€“ main branch HEAD = 84a680a
#   â€“ working branch   = chore/restore-hotfix-scripts       (push target)
#   â€“ validator_tiers.yaml & risk_overlay_emitter.py exist
#   â€“ pre-commit mypy hook fails due to types-all
#
# Please execute the following **in order** and commit with --no-verify:

1. ğŸ—ƒ **Ensure package init guards**
   * If missing, create empty `__init__.py` in:
       universal_recon/analytics
       universal_recon/analytics/assets
   * Do *not* touch other folders.

2. ğŸ›  **Parameterise `plugin_usage_diff.py`**
   * Add `--before` and `--after` args (paths to two schema_matrix*.json).
   * Keep fallback: if absent, compare *latest two* snapshots in output/archive/.
   * Output JSON â†’ `output/plugin_diff.json`.
   * Update `help` text and `__main__` guard.

3. ğŸ§ª **Unit tests**
   * Add `tests/analytics/test_plugin_usage_diff.py` that:
       â€“ generates two tiny dummy matrices in tmp_path
       â€“ runs `plugin_usage_diff.main()` via subprocess
       â€“ asserts JSON has correct â€œaddedâ€ / â€œremovedâ€.

4. ğŸ”§ **pre-commit overhaul**
   * In `.pre-commit-config.yaml`
       â€“ comment out the mypy mirror that pulls `types-all`
       â€“ add Ruff formatter & Black:
         ```yaml
         -   repo: https://github.com/charliermarsh/ruff-pre-commit
             rev: v0.4.3
             hooks: [{ id: ruff, args: [--fix] }]
         -   repo: https://github.com/psf/black
             rev: 24.4.2
             hooks: [{ id: black }]
         ```
   * Run `pre-commit autoupdate` and reinstall hooks.

5. ğŸ§¹ **Format & lint**
   * Run `pre-commit run --all-files` â€“ ensure **no failures**.

6. ğŸ“ **Update docs**
   * Append a â€œPhase 27 changelogâ€ section to `README_phase_27.md`
     summarising the new CLI flags and risk overlay.

7. ğŸ’¾ **Commit & push**
   * `git add` the modified files + new tests + README.
   * `git commit -m "feat: Phase-27 CLI diff flags & lint cleanup" --no-verify`
   * `git push -u origin chore/restore-hotfix-scripts`

8. ğŸª„ **Open a PR**
   * Use GitHub CLI: `gh pr create --fill --base main --head chore/restore-hotfix-scripts`
   * Title: â€œPhase 27 â€“ plugin diff flags & CI lint cleanâ€
   * Body: include bullet list of tasks above.

9. ğŸ“£ **Post-run summary**
   * Reply in this chat with:
       â€“ âœ… pre-commit status
       â€“ âœ… pytest summary
       â€“ PR URL.

# End of task list
