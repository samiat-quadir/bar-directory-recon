name: fast-parity-ci
on:
    pull_request:
    push:
        branches: [main]
jobs:
    ubuntu:
        name: fast-tests (ubuntu-latest)
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4
            - uses: actions/setup-python@v5
              with: { python-version: "3.11" }
            - name: Install (prefer lockfile)
              run: |
                  python -m pip install -U pip
                  if [ -f requirements-lock.txt ]; then
                    python -m pip install -r requirements-lock.txt
                    python -m pip install -e .[dev] --no-deps
                  else
                    python -m pip install -e .[dev]
                  fi
            - name: Run fast tests
              run: pytest -q -m "not slow and not e2e and not integration"

    windows:
        name: fast-tests (windows-latest)
        runs-on: windows-latest
        steps:
            - uses: actions/checkout@v4
            - uses: actions/setup-python@v5
              with: { python-version: "3.11" }
            - name: Install (prefer lockfile)
              shell: pwsh
              run: |
                  python -m pip install -U pip
                  if (Test-Path 'requirements-lock.txt') {
                    python -m pip install -r requirements-lock.txt
                    python -m pip install -e .[dev] --no-deps
                  } else {
                    python -m pip install -e .[dev]
                  }
            - name: Run fast tests
              shell: pwsh
              run: pytest -q -m "not slow and not e2e and not integration"
